<div class="card-body">
  <div class="card-title d-flex justify-content-between">
    <div class="col-md-6 px-0">
      <h4 class="text-primary">Tipos de activos fijos</h4>
    </div>
    <div class="col-md-6 px-0 text-right">
      <div class="btn-group rounded w-sm-100">
        <button
          class="btn btn-primary btn-sm"
          (click)="openConfirm(add, 'Nuevo tipo de activo fijo')"
        >
          <i class="fa fa-plus"></i>
          Agregar<!--  (click)="ModalTipoActivo.show();" -->
        </button>
        <button
          class="btn btn-info btn-sm"
          style="float: right"
          (click)="openClose()"
        >
          <i class="fas fa-sliders-h"></i> Filtros
        </button>
      </div>
    </div>
  </div>
  <hr class="line" />
  <mat-accordion multi>
    <mat-expansion-panel class="mat-elevation-z0">
      <mat-form-field class="col-md-3 pl-0" appearance="outline">
        <mat-label>Nombre</mat-label>
        <input
          matInput
          type="text"
          placeholder="Busca por nombre"
          [(ngModel)]="Filtros.nombre"
          (change)="ConsultaFiltrada()"
          name="name"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field class="col-md-3 pl-0" appearance="outline">
        <mat-label>Categoría</mat-label>
        <input
          matInput
          type="text"
          placeholder="Busca por categoría"
          [(ngModel)]="Filtros.categoria"
          (change)="ConsultaFiltrada()"
          name="name"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field class="col-md-3 pl-0" appearance="outline">
        <mat-label>Vida útil</mat-label>
        <input
          matInput
          type="text"
          placeholder="Busca por vida útil"
          [(ngModel)]="Filtros.vida_util"
          (change)="ConsultaFiltrada()"
          name="name"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field class="col-md-3 pl-0" appearance="outline">
        <mat-label>Depreciación</mat-label>
        <input
          matInput
          type="text"
          placeholder="Busca por depreciación"
          [(ngModel)]="Filtros.depreciacion"
          (change)="ConsultaFiltrada()"
          name="name"
          autocomplete="off"
        />
      </mat-form-field>
    </mat-expansion-panel>
  </mat-accordion>
  <div class="rounded-top table-responsive">
    <table
      class="table table-bordered table-hover table-striped table-sm"
      *ngIf="!Cargando && TiposActivosFijos.length > 0; else notData"
    >
      <thead class="bg-light">
        <tr class="text-center text-uppercase">
          <th class="align-middle">Tipo Activo</th>
          <th class="align-middle">Categoría</th>
          <th class="align-middle">Vida Util</th>
          <th class="align-middle">% Depreciación</th>
          <th class="align-middle">Cuenta Depreciación</th>
          <!-- <th class="align-middle">Cuenta Depreciación PCGA</th> -->
          <th class="align-middle">Cuenta Activa</th>
          <!-- <th class="align-middle">Cuenta PCGA</th> -->
          <!-- <th class="align-middle">Cuenta Credito PCGA</th> -->
          <th class="align-middle">Cuenta Credito</th>
          <th class="align-middle col-1">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let taf of TiposActivosFijos"
          class="text-center"
          [ngClass]="{
            'text-danger font-weight-bold': taf.Estado == 'Inactivo'
          }"
        >
          <td class="align-middle">{{ taf.Nombre_Tipo_Activo }}</td>
          <td class="align-middle">{{ taf.Categoria }}</td>
          <td class="align-middle">
            {{ taf.Vida_Util }} mes{{ taf.Vida_Util > 1 ? "es" : "" }}
          </td>
          <td class="align-middle">
            {{ taf.Porcentaje_Depreciacion_Anual }} %
          </td>
          <td class="align-middle">{{ taf.Cuenta_Depreciacion_NIIF }}</td>
          <!-- <td class="align-middle">{{ taf.Cuenta_Depreciacion_PCGA }}</td> -->
          <td class="align-middle">{{ taf.Cuenta_Niif }}</td>
          <!-- <td class="align-middle">{{ taf.Cuenta_Pcga }}</td> -->
          <!-- <td class="align-middle">{{ taf.Cuenta_Credito_Pcga }}</td> -->
          <td class="align-middle">{{ taf.Cuenta_Credito_Niif }}</td>
          <td class="align-middle">
            <div ngbDropdown container="body" class="dropdown-primary">
              <button
                ngbDropdownToggle
                class="btn btn-primary btn-sm waves-light"
                type="button"
              >
                <i class="mdi mdi-chevron-down"></i>
              </button>
              <div ngbDropdownMenu>
                <a
                  class="dropdown-item waves-light waves-effect text-info caja-botones"
                  (click)="
                    gettipoActivosFijos(taf);
                    openConfirm(add, 'Editar tipo de activo fijo')
                  "
                  ><!-- EditarTipoActivo(taf.Id_Tipo_Activo_Fijo); -->
                  <i class="ti-pencil"></i> Editar</a
                >
                <a
                  *ngIf="taf.Estado == 'Activo'"
                  class="dropdown-item waves-light waves-effect text-danger caja-botones"
                  (click)="activateOrInactivate(taf, 'Inactivo')"
                >
                  <i class="far fa-trash-alt"></i> Anular</a
                >
                <a
                  *ngIf="taf.Estado == 'Inactivo'"
                  class="dropdown-item waves-light waves-effect text-success caja-botones"
                  (click)="activateOrInactivate(taf, 'Activo')"
                >
                  <i class="fa fa-check"></i> Activar</a
                >
                <!-- <a
                  class="dropdown-item waves-light waves-effect caja-botones"
                  [swal]="{
                    title: '¿Está Seguro?',
                    text: 'Se dispone inactivar este tipo de activo fijo',
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Si, Eliminar',
                    cancelButtonText: 'No, Dejame Comprobar!'
                  }"
                  (confirm)="EliminarTipoActivoFijo(taf)"
                >
                  <i class="ti-trash"></i> Eliminar</a
                > -->
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <ngb-pagination
    *ngIf="TiposActivosFijos.length > 0"
    class="d-flex justify-content-center pagination-rounded pagination-sm"
    [collectionSize]="TotalItems"
    [pageSize]="pageSize"
    [(page)]="page"
    (pageChange)="ConsultaFiltrada(true, $event)"
    aria-label="Default pagination"
    [maxSize]="maxSize"
    rotate="true"
    ellipses="false"
    boundaryLinks="true"
    rotate="true"
    ellipses="false"
    boundaryLinks="true"
  >
  </ngb-pagination>
  <!-- <div id="paginacion-container" *ngIf="TiposActivosFijos.length > 0">
    <div class="row">
      <div class="col-md-3">
        <p>
          <b
            >Mostrando del {{ InformacionPaginacion.desde }} al
            {{ InformacionPaginacion.hasta }} de
            {{ InformacionPaginacion.total }}</b
          >
        </p>
      </div>
      <div class="col-md-9">
        <ngb-pagination
          class="pull-right"
          [collectionSize]="TotalItems"
          [(page)]="page"
          [maxSize]="maxSize"
          [pageSize]="pageSize"
          size="sm"
          (pageChange)="ConsultaFiltrada(true)"
          [boundaryLinks]="true"
        ></ngb-pagination>
      </div>
    </div>
  </div> -->
</div>

<ng-template #add let-modal>
  <div class="modal-header">
    <h4 class="text-primary modal-title">{{ title }}</h4>
    <button
      type="button"
      class="close"
      data-dismiss="modal"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="form">
      <div class="row">
        <mat-form-field class="col" appearance="outline">
          <mat-label>Nombre</mat-label>
          <input
            matInput
            type="text"
            placeholder="Ingresa el nombre"
            formControlName="Nombre_Tipo_Activo"
            required
            autocomplete="off"
          />
        </mat-form-field>
        <mat-form-field class="col" appearance="outline">
          <mat-label>Categoría</mat-label>
          <mat-select formControlName="Categoria">
            <mat-option value="Tangible">Tangible</mat-option>
            <mat-option value="Intangible">Intangible</mat-option>
          </mat-select>
        </mat-form-field>
        <!-- <mat-form-field class="col" appearance="outline">
          <mat-label>Vida útil PCGA (meses)</mat-label>
          <input
            matInput
            type="number"
            placeholder="Ingresa la vida útil"
            formControlName="Vida_Util_PCGA"
            required
            (change)="calculateDepreciationPercentage('pcga')"
            autocomplete="off"
          />
        </mat-form-field> -->
        <mat-form-field class="col" appearance="outline">
          <mat-label>Vida útil (meses)</mat-label>
          <input
            matInput
            type="number"
            placeholder="Ingresa la vida útil"
            formControlName="Vida_Util"
            required
            (input)="calcularPorcentajeDepreciacion()"
            autocomplete="off"
          />
        </mat-form-field>
        <!-- <mat-form-field class="col" appearance="outline">
          <mat-label>Porcentaje de depreciación PCGA mensual</mat-label>
          <input
            matInput
            type="text"
            formControlName="Porcentaje_Depreciacion_Anual_PCGA"
            required
            readonly
            autocomplete="off"
          />
        </mat-form-field> -->
        <mat-form-field class="col" appearance="outline">
          <mat-label>Porcentaje de depreciación anual</mat-label>
          <input
            matInput
            type="text"
            formControlName="Porcentaje_Depreciacion_Anual"
            required
            readonly
            autocomplete="off"
          />
        </mat-form-field>
        <!-- <mat-form-field class="col" appearance="outline">
            <mat-label>Cuenta activo PCGA</mat-label>
            <input
              matInput
              type="text"
              formControlName="Id_Plan_Cuenta_PCGA"
              required
              [ngbTypeahead]="search"
              [inputFormatter]="inputFormatBandListValue"
              [resultFormatter]="resultFormatBandListValue"
              [editable]="false"
              autocomplete="off"
            />
          </mat-form-field> -->
        <mat-form-field class="col" appearance="outline">
          <mat-label>Cuenta activo</mat-label>
          <input
            matInput
            type="text"
            required
            [editable]="false"
            autocomplete="off"
            [ngbTypeahead]="search_cuenta_niif"
            [resultTemplate]="rt2"
            [inputFormatter]="formatter2"
            [resultFormatter]="formatter2"
            [class.is-invalid]="busquedaCuentaFallida"
            (selectItem)="AsignarCuentaNiif($event)"
          />
          <mat-hint *ngIf="buscandoCuenta">Buscando</mat-hint>
          <mat-hint *ngIf="busquedaCuentaFallida">
            No hemos encontrado resultados</mat-hint
          >
        </mat-form-field>
        <div *ngIf="false">
          <!-- <mat-form-field class="col" appearance="outline">
            <mat-label>Cuenta débito depreciación PCGA</mat-label>
            <input
              matInput
              type="text"
              formControlName="Id_Plan_Cuenta_Debito_Depreciacion_PCGA"
              required
              [ngbTypeahead]="search"
              [inputFormatter]="inputFormatBandListValue"
              [resultFormatter]="resultFormatBandListValue"
              [editable]="false"
              autocomplete="off"
            />
          </mat-form-field>
          <mat-form-field class="col" appearance="outline">
            <mat-label>Cuenta débito depreciación</mat-label>
            <input
              matInput
              type="text"
              formControlName="Id_Plan_Cuenta_Debito_Depreciacion_NIIF"
              required
              [ngbTypeahead]="searchNiif"
              [inputFormatter]="inputFormatListValueNiif"
              [resultFormatter]="resultFormatListValueNiif"
              [editable]="false"
              autocomplete="off"
            />
          </mat-form-field> -->
          <!-- <mat-form-field class="col" appearance="outline">
            <mat-label>Cuenta crédito depreciación PCGA</mat-label>
            <input
              matInput
              type="text"
              formControlName="Id_Plan_Cuenta_Credito_Depreciacion_PCGA"
              required
              [ngbTypeahead]="search"
              [inputFormatter]="inputFormatBandListValue"
              [resultFormatter]="resultFormatBandListValue"
              [editable]="false"
              autocomplete="off"
            />
          </mat-form-field> -->
          <mat-form-field class="col" appearance="outline">
            <mat-label>Cuenta crédito depreciación</mat-label>
            <input
              matInput
              type="text"
              formControlName="Id_Plan_Cuenta_Credito_Depreciacion_NIIF"
              required
              [ngbTypeahead]="searchNiif"
              [inputFormatter]="inputFormatListValueNiif"
              [resultFormatter]="resultFormatListValueNiif"
              [editable]="false"
              autocomplete="off"
            />
          </mat-form-field>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-danger"
      (click)="modal.dismiss('Cross click')"
    >
      Cancelar
    </button>
    <button
      type="button"
      (click)="GuardarTipoActivo()"
      [disabled]="!form.valid"
      class="btn btn-primary"
    >
      Guardar
    </button>
  </div>
</ng-template>

<ng-template #notData>
  <app-not-data [loading]="Cargando"></app-not-data>
</ng-template>

<!-- <app-modal-basic
  [dialogClass]="'modal-lg'"
  id="ModalTipoActivo"
  #ModalTipoActivo
>
  <div class="app-modal-header">
    <h4>Nuevo Tipo de Activo</h4>
    <button
      type="button"
      class="close basic-close"
      (click)="CerrarModalTipoActivo()"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div
    style="overflow-x: unset !important; overflow-y: unset !important"
    class="app-modal-body"
  >
    <form #FormTipoActivo="ngForm">
      <div class="form-row mb-2">
        <div class="col-md-6">
          <label>Nombre Tipo Activo</label>
          <input
            type="text"
            class="form-control form-control-sm"
            name="Nombre_Tipo_Activo"
            required
            [(ngModel)]="TipoActivoModel.Nombre_Tipo_Activo"
          />
        </div>
        <div class="col-md-6">
          <label>Categoría</label>
          <select
            name="Categoria"
            id="Categoria"
            class="form-control form-control-sm"
            name="Categoria"
            required
            [(ngModel)]="TipoActivoModel.Categoria"
          >
            <option value="Tangible">Tangible</option>
            <option value="Intangible">Intangible</option>
          </select>
        </div>
      </div>
      <div class="form-row mb-2">
        <div class="col-md-6">
          <label>Vida Util PCGA (Meses)</label>
          <input
            type="number"
            class="form-control form-control-sm"
            name="Vida_Util_Pcga"
            required
            [(ngModel)]="TipoActivoModel.Vida_Util_PCGA"
            (change)="calcularPorcentajeDepreciacion('pcga')"
          />
        </div>

        <div class="col-md-6">
          <label>Vida Util NIIF (Meses)</label>
          <input
            type="number"
            class="form-control form-control-sm"
            name="Vida_Util"
            required
            [(ngModel)]="TipoActivoModel.Vida_Util"
            (change)="calcularPorcentajeDepreciacion('niif')"
          />
        </div>

        <div class="col-md-6">
          <label>Porcentaje de Depreciación PCGA Mensual</label>
          <input
            type="number"
            class="form-control form-control-sm"
            name="Porcentaje_Depreciacion_Anual_Pcga"
            required
            [(ngModel)]="TipoActivoModel.Porcentaje_Depreciacion_Anual_PCGA"
            readonly
          />
        </div>

        <div class="col-md-6">
          <label>Porcentaje de Depreciación NIIF Mensual</label>
          <input
            type="number"
            class="form-control form-control-sm"
            name="Porcentaje_Depreciacion_Anual"
            required
            [(ngModel)]="TipoActivoModel.Porcentaje_Depreciacion_Anual"
            readonly
          />
        </div>

        <div class="col-md-6">
          <label>Cuenta Activo PCGA</label>
          <input
            type="text"
            class="form-control form-control-sm"
            name="Id_Plan_Cuenta_PCGA"
            required
            [ngbTypeahead]="search_cuenta"
            [resultTemplate]="rt1"
            [(ngModel)]="CuentaPcga"
            [inputFormatter]="formatter1"
            (change)="AsignarCuentaPcga(CuentaPcga)"
          />
        </div>

        <div class="col-md-6">
          <label>Cuenta Activo NIIF</label>
          <input
            type="text"
            class="form-control form-control-sm"
            name="Id_Plan_Cuenta_NIIF"
            required
            [ngbTypeahead]="search_cuenta_niif"
            [resultTemplate]="rt2"
            [(ngModel)]="CuentaNiif"
            [inputFormatter]="formatter2"
            (change)="AsignarCuentaNiif(CuentaNiif)"
          />
        </div>

        <div class="col-md-6">
          <label>Cuenta Debito Depreciacion PCGA</label>
          <input
            type="text"
            class="form-control form-control-sm"
            name="Id_Plan_Cuenta_Depreciacion_PCGA"
            required
            [ngbTypeahead]="search_cuenta"
            [resultTemplate]="rt1"
            [(ngModel)]="CuentaDepreciacionPcga"
            [inputFormatter]="formatter1"
            (change)="AsignarCuentaDepreciacion(CuentaDepreciacionPcga, 'pcga')"
          />
        </div>

        <div class="col-md-6">
          <label>Cuenta Debito Depreciacion NIIF</label>
          <input
            type="text"
            class="form-control form-control-sm"
            name="Id_Plan_Cuenta_Depreciacion_NIIF"
            required
            [ngbTypeahead]="search_cuenta_niif"
            [resultTemplate]="rt2"
            [(ngModel)]="CuentaDepreciacionNiif"
            [inputFormatter]="formatter2"
            (change)="AsignarCuentaDepreciacion(CuentaDepreciacionNiif, 'niif')"
          />
        </div>

        <div class="col-md-6">
          <label>Cuenta Credito Depreciacion PCGA</label>
          <input
            type="text"
            class="form-control form-control-sm"
            name="Id_Plan_Cuenta_Credito_Depreciacion_PCGA"
            required
            [ngbTypeahead]="search_cuenta"
            [resultTemplate]="rt1"
            [(ngModel)]="CuentaCreditoDepreciacionPcga"
            [inputFormatter]="formatter1"
            (change)="
              AsignarCuentaCreditoDepreciacion(
                CuentaCreditoDepreciacionPcga,
                'pcga'
              )
            "
          />
        </div>

        <div class="col-md-6">
          <label>Cuenta Credito Depreciacion NIIF</label>
          <input
            type="text"
            class="form-control form-control-sm"
            name="Id_Plan_Cuenta_Credito_Depreciacion_NIIF"
            required
            [ngbTypeahead]="search_cuenta_niif"
            [resultTemplate]="rt2"
            [(ngModel)]="CuentaCreditoDepreciacionNiif"
            [inputFormatter]="formatter2"
            (change)="
              AsignarCuentaCreditoDepreciacion(
                CuentaCreditoDepreciacionNiif,
                'niif'
              )
            "
          />
        </div>
      </div>
    </form>
  </div>
  <div class="app-modal-footer">
    <div class="text-right">
      <button
        class="btn btn-primary btn-sm"
        style="display: flex; align-items: center"
        [swal]="{
          title: '¿Está Seguro?',
          text: 'Se dispone a guardar este tipo contrato',
          type: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Si, Guardar',
          cancelButtonText: 'No, Comprobar!'
        }"
        (confirm)="GuardarTipoActivo()"
        [disabled]="!FormTipoActivo.valid"
      >
        <i class="ti-save font-size-15 mr-2"></i> Guardar datos
      </button>
    </div>
  </div>
</app-modal-basic> -->

<ng-template #rt1 let-r="result" let-t="term">
  <span class="f-9">{{ r.Nombre }} - {{ r.Codigo }} </span>
</ng-template>
<ng-template #rt2 let-r="result" let-t="term">
  <span class="f-9">{{ r.Nombre_Niif }} - {{ r.Codigo_Niif }} </span>
</ng-template>
