<div class="card">
    <div class="card-header">
        <div class="row">
            <div class="col-md-6">
                <h5>Productos</h5>
                <span>Listado de Productos registrados en nuestras bases de datos</span>
            </div>
            <div class="col-md-6 text-right">

                <button type="button" class="btn btn-warning" (click)="modal.show()">
                                  <i class="fa fa-plus"></i> Agregar Nuevo Producto
              </button>

            </div>
        </div>
    </div>
    <div class="card-body">

        <br>

        <div class="row">
            <div class="col-md-12">
                <table class="table table-striped" style="font-size: 10px;">
                    <thead>
                        <tr>
                            <th style="width: 130px !important; max-width: 380px !important">Nombre</th>
                            <th style="width: 130px !important; max-width: 130px !important">Embalaje</th>
                            <th style="width: 100px !important; max-width: 100px !important">Descripción</th>
                            <th style="width: 100px !important; max-width: 100px !important">Invima</th>
                            <th style="width: 70px !important; max-width: 70px !important">Codigo Barras</th>
                            <th style="width: 70px !important; max-width: 70px !important">Categoria</th>
                            <th style="width: 70px !important; max-width: 70px !important">Tipo Catalogo</th>
                            <th style="width: 100px !important; max-width: 100px !important; text-align: center">Acciones</th>
                        </tr>
                        <!--
                      <tr>
                          <th class="tabla-filtros"></th>
                          <th class="tabla-filtros">
                              <input type='text' class="form-control input-sm " [(ngModel)]="filtro_cum" placeholder='Filtro CUM' />
                          </th>
                          <th class="tabla-filtros">
                              <input type='text' class="form-control input-sm " [(ngModel)]="filtro_nombre" placeholder='Filtro Nombre' />
                          </th>
                          <th class="tabla-filtros">
                              <input type='text' class="form-control input-sm " [(ngModel)]="filtro_nom_com" placeholder='Filtro Nom.Comercial' />
                          </th>
                          <th class="tabla-filtros">
                              <input type='text' class="form-control input-sm " [(ngModel)]="filtro_lab" placeholder='Filtro Lab.' />
                          </th>
                          <th class="tabla-filtros">
                              <input type='text' class="form-control input-sm " [(ngModel)]="filtro_lab_gral" placeholder='Filtro Lab. Gral' />
                          </th>
                          <th class="tabla-filtros">
                              <input type='text' class="form-control input-sm " [(ngModel)]="filtro_inv" placeholder='Filtro Invima' />
                          </th>
                          <th class="tabla-filtros">
                              <select class="form-control input-sm">
                                              <option value="" selected>Todos</option>
                                              <option value="Material">Material</option>
                                              <option value="Medicamento">Medicamento</option>
                                              <option value="Medicamento">Generico</option>
                                          </select>
                          </th>
                          <th class="tabla-filtros">
                              <div class="text-center">
                                  <button class="btn btn-primary btn-sm" style="margin-top: 0 !important; border-radius: 100%; padding: 5px !important;" (click)="filtro()" title="Filtrar">
                                                  <i class="fa fa-search"></i>
                                              </button>
                              </div>
                          </th>
                      </tr>
                    -->


                    </thead>
                    <tbody>
                        <tr *ngFor="let producto of Productos" [ngClass]="{'bg-danger': producto.Estado=='Inactivo'}">

                            <td style="width: 70px !important; max-width: 70px !important">
                                {{producto.Cum}}
                            </td>
                            <td *ngIf="producto.Tipo == 'Generico'" style="white-space: normal !important;min-width: 450px; max-width: 450px;">
                                {{producto.Principio_Activo}}
                            </td>
                            <td *ngIf="producto.Tipo != 'Generico'" style="white-space: normal !important;min-width: 450px; max-width: 450px;">
                                {{producto.Nombre}}
                            </td>
                            <td style="width: 100px !important; max-width: 100px !important">
                                <span class="mytooltip tooltip-effect-2"><span class="tooltip-item2">
                                             <p style="font-size:11px">
                                                <i class="fa fa-info-circle"></i> Nom. Comercial
                                             </p>
                                          </span>
                                <span class="tooltip-content4 clearfix">
                                            <span class="tooltip-text2">{{producto.Nombre_Comercial}}</span>
                                </span>
                                </span>


                            </td>
                            <td style="width: 100px !important; max-width: 100px !important">
                                {{producto.Generico}}
                            </td>
                            <td style="width: 100px !important; max-width: 100px !important">
                                {{producto.Comercial}}
                            </td>
                            <td style="width: 70px !important; max-width: 70px !important">
                                {{producto.Invima}}
                            </td>
                            <td style="width: 70px !important; max-width: 70px !important">
                                {{producto.Tipo}}
                            </td>
                            <td style="width: 100px !important; max-width: 100px !important">
                                <div ngbDropdown class="dropdown-primary">
                                    <button ngbDropdownToggle class="btn btn-primary btn-sm waves-effect waves-light" type="button">
                                <i class="mdi mdi-chevron-down"></i>
                              </button>
                                    <div ngbDropdownMenu>
                                        <a class="dropdown-item waves-light waves-effect" (click)="EditSubcategory(item);modal.show()">
                                            <i class="fas fa-user-edit mr-1"></i>Editar
                                        </a>
                                        <a class="dropdown-item waves-light waves-effect" [swal]="{ title : '¿Está Seguro?', text : 'Se dispone a Eliminar esta Subcategoria, esta acción no se puede revertir' , type : 'warning', showCancelButton : true , confirmButtonText : 'Si, Eliminar', cancelButtonText : 'No, Dejame Comprobar!' }"
                                            (confirm)="deleteSubcategory(item.Id_subcategoria)">
                                            <i class="far fa-trash-alt mr-1"></i>Eliminar</a>

                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- <ngb-pagination class="pull-right" [collectionSize]="TotalItems" [(page)]="page" [maxSize]="maxSize" size="sm" (pageChange)="paginacion()" [boundaryLinks]="true"></ngb-pagination> -->


    </div>

</div>



<app-modal-basic #modal [dialogClass]="'modal-lg'">
    <div class="app-modal-header">
        <!-- <h4 class="modal-title">{{title}}</h4> -->
        <h4 class="modal-title">Crear Producto</h4>
        <button type="button" class="close basic-close" (click)="closeModal()">
        <span aria-hidden="true">&times;</span>
    </button>
    </div>
    <div class="app-modal-body modal-lg ">
        <form [formGroup]="form">
            <!-- <input type="hidden" class="form-control"> -->
            <div class="row">
                <div class="col-md-12">
                    <div class="row">

                        <div class="col-md-12">

                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Nombre</label>
                                        <input type="text" class="form-control" formControlName="Nombre_Comercial">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Embalaje</label>
                                        <input type="text" class="form-control" formControlName="Embalaje">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Descripcion</label>
                                        <textarea type="text" class="form-control" formControlName="Descripcion_ATC"></textarea>
                                    </div>
                                </div>

                            </div>

                            <div class="row">

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Codigo Barras</label>
                                        <input type="text" class="form-control" formControlName="Codigo_Barras">
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Invima</label>
                                        <input type="text" class="form-control" formControlName="Invima">
                                    </div>
                                </div>


                                <!-- <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Invima</label>
                                        <input type="text" class="form-control" formControlName="Invima">
                                    </div>
                                </div> -->

                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Categoria</label>
                                        <ng-select formControlName="Id_Categoria" [items]="Categorias" bindLabel="text" (change)="getSubCategories($event.value)" bindValue="value" loadingText="loading" ngDefaultControl>
                                        </ng-select>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Subcategoría</label>
                                        <ng-select formControlName="Id_Subcategoria" [items]="SubCategorias" bindLabel="text" (change)="getDinamicField($event.value)" bindValue="value" loadingText="loading" ngDefaultControl>
                                        </ng-select>
                                    </div>
                                </div>


                                <ng-container formArrayName="dynamic">
                                    <ng-container *ngFor="let item of fieldDinamic.controls; let i = index">
                                        <div class="col-md-3" [formGroupName]="i">

                                            <label for="">{{item['controls']['label']['value'] | titlecase}}</label>
                                            <input class="form-control form-control-sm" [type]="item['controls']['type']['value']" formControlName="valor">
                                        </div>

                                    </ng-container>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


        </form>
    </div>
    <div class="app-modal-footer">
        <div class="text-right">
            <button type="button" class="btn btn-default btn-sm" (click)="closeModal()">Cancelar</button>
            <button type="button" class="btn btn-primary btn-sm" [swal]="{title : '¿Está Seguro?', text: 'Se dispone a Guardar este Producto' , icon : 'warning', showCancelButton : true , confirmButtonText: 'Si, Guardar',cancelButtonText: 'No,Dejame Comprobar!'}"
                (confirm)="saveProduct()">Guardar</button>
        </div>
    </div>

</app-modal-basic>