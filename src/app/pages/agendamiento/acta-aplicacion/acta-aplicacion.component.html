<div class="card">
  <div class="card-body">
    <form [formGroup]="form" class="p-3">
      <div class="row">
        <div class="form-group col-md-4">
          <label for="">Paciente</label>
          <ng-select
            formControlName="person"
            [items]="people"
            bindLabel="text"
            bindValue="value"
            loadingText="loading "
            ngDefaultControl
          >
          </ng-select>
        </div>

        <div class="col-md-3">
          <label>Fecha</label>
          <input
            formControlName="date"
            type="date"
            class="form-control form-control-sm date"
            [placeholder]=""
            name="date"
          />
        </div>

        <div class="col-md-4">
          <button
            style="float: right"
            type="button"
            class="btn btn-primary mt-4"
            (click)="listarProducto()"
          >
            <i class="fa fa-plus"></i>
            Agregar Producto
          </button>
        </div>
      </div>

      <div class="row">
        <div class="form-group col-md-4">
          <label for="">CUPs</label>
          <ng-select
            formControlName="cups"
            [items]="cups"
            bindLabel="text"
            bindValue="value"
            loadingText="loading "
            ngDefaultControl
          >
          </ng-select>
        </div>

        <div class="form-group col-md-4">
          <label for="">Diagnostico Principal</label>
          <ng-select
            formControlName="diagnostic"
            [items]="diagnostics"
            bindLabel="text"
            bindValue="value"
            loadingText="loading "
            ngDefaultControl
          >
          </ng-select>
        </div>

        <div class="form-group col-md-4">
          <label for="">Diagnostico Secundario</label>
          <ng-select
            formControlName="diagnostic"
            [items]="diagnostics"
            bindLabel="text"
            bindValue="value"
            loadingText="loading "
            ngDefaultControl
          >
          </ng-select>
        </div>
      </div>

      <div class="row">
        <div class="form-group col-md-8">
          <label for="">Nota Enfermeria</label>

          <textarea
            class="form-control form-control-sm"
            cols="100%"
            formControlName="observation"
            rows="10"
          ></textarea>
        </div>
      </div>

      <!-- <table class="table table-borderless table-striped" *ngIf="!loading && thirdParties.length > 0; else notData">-->
      <table class="table table-borderless table-striped">
        <thead class="bg-light">
          <tr>
            <th></th>
            <th>Producto</th>
            <th>Lote</th>
            <th>Vence</th>
            <th>Cum</th>
            <th>Cantidad</th>

            <th class="text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <ng-container formArrayName="productSelected">
            <ng-container
              *ngIf="getProductList.controls.length && !loading; else notData"
            >
              <ng-container
                *ngFor="let pl of getProductList['controls']; let i = index"
              >
                <tr [formGroupName]="i">
                  <td></td>
                  <td>{{ pl.value.Nombre_Comercial }}</td>
                  <td>{{ pl.value.Lote }}</td>
                  <td>{{ pl.value.Codigo_Cum }}</td>
                  <td>{{ pl.value.Codigo_Cum }}</td>
                  <td>
                    <input
                      formControlName="Cantidad"
                      class="form-control input"
                      type="text"
                    />
                  </td>
                  <td>
                    <div class="text-center">
                      <button
                        class="btn btn-success btn-sm"
                        style="float: right"
                        (click)="modalDocuments.show()"
                      >
                        <i class="fas fa-file-pdf"></i>
                      </button>
                      <button
                        class="btn btn-danger btn-sm"
                        type="button"
                        (click)="deletedProduct(i)"
                      >
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </ng-container>
        </tbody>
      </table>
    </form>
    <button
      type="submit"
      class="btn btn-primary btn-sm raised"
      (click)="verF()"
    >
      Agregar
    </button>
  </div>
</div>

<app-modal-basic [dialogClass]="'modal-lg'" id="modal" #modal>
  <div class="app-modal-header">
    <h4 class="modal-title">Listado de Productos</h4>
    <button type="button" class="close basic-close" (click)="close()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="form-row">
      <div class="col-md-12">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th></th>
              <th class="text-left fs-3">Nombre</th>
              <th class="text-left fs-3">Cum</th>
              <th class="text-left fs-3">Lote</th>
              <th class="text-right fs-3">Cantidad</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of ListaProductos; let i = index"
              id="fila{{ i }}"
            >
              <td style="width: 25px" class="text-center">
                <input
                  type="checkbox"
                  (change)="selectedProduct($event, i)"
                  [Nombre_Comercial]="item.Nombre_Comercial"
                  [Codigo_Cum]="item.Codigo_Cum"
                  [Lote]="item.Lote"
                  [Id_Producto]="item.Id_Producto"
                />
              </td>
              <td>{{ item.Nombre_Comercial }}</td>
              <td>{{ item.Codigo_Cum }}</td>
              <td>{{ item.Lote }}</td>
              <td class="text-left">{{ item.cantidadA }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="app-modal-footer">
    <div class="form-group text-right">
      <button
        type="button"
        (click)="close()"
        class="btn btn-danger raised mr-2 btn-sm"
      >
        Cerrar
      </button>
      <button
        type="submit"
        class="btn btn-primary btn-sm raised"
        (click)="addProduct()"
      >
        Agregar
      </button>
    </div>
  </div>
</app-modal-basic>

<app-modal-basic #modalDocuments [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h5 class="modal-title">Agregar Documentos</h5>
    <button
      type="button"
      class="close basic-close"
      (click)="hideModalDocuments()"
    >
      <span aria-hidden="true">
        <i class="fas fa-times" (click)="hideModalDocuments()"></i>
      </span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="col-12">
      <label for="">Documentos</label>
      <div class="col"></div>
    </div>
    <div class="form-group">
      <label for="file">File</label>
      <input
        formControlName="file"
        id="file"
        type="file"
        multiple
        class="form-control"
        (change)="onFileChange($event)"
      />
      <div *ngIf="f.file.touched && f.file.invalid" class="alert alert-danger">
        <div *ngIf="f.file.errors && f.file.errors.required">
          File is required.
        </div>
      </div>
    </div>
  </div>
  <div class="app-modal-footer">
    <div class="form-group text-right">
      <button
        (click)="hideModalDocuments()"
        type="button"
        class="btn btn-danger raised mr-2 btn-sm"
      >
        Cerrar
      </button>
      <button
        type="submit"
        class="btn btn-primary btn-sm raised"
        (click)="saveDocuments()"
      >
        Guardar Documentos
      </button>
    </div>
  </div>
</app-modal-basic>

<ng-template #notData>
  <tr>
    <td colspan="100%">
      <app-not-data [loading]="loading"></app-not-data>
    </td>
  </tr>
</ng-template>
